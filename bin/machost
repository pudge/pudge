#!/usr/bin/perl
use warnings;
use strict;
use feature ':5.10';

use File::Spec::Functions;

my @try = (
    sub {
        my $file = catfile($ENV{HOME}, '.machost');
        return unless -e $file;
        open my $fh, '<', $file or return;
        chomp(my $host = readline($fh));
        return $host;
    },
    sub {
        chomp(my $host = `tshost 2>/dev/null`);
        return $host;
    },
    sub {
        (my $host = $ENV{SSH_CONNECTION} || $ENV{SSH_CLIENT})
            =~ s/^([\w\.]+).*$/$1/;
        return $host;
    },
);

for (@try) {
    my $host = $_->();
    if (defined $host && length $host) {
        say $host;
        exit;
    }
}
